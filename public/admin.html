<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Team Scheduler</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div id="scheduler">
    <!-- Team Management Section -->
    <div id="team-management">
        <h3>Team Members</h3>
        <div id="team-input-area" class="add-member-form">
            <input type="text" id="memberNameInput" placeholder="Enter member name" required>
            <input type="tel" id="memberPhoneInput" placeholder="Phone number (optional)">
            <button id="addMemberBtn">Add</button>
        </div>
        <ul id="team-list">
             <!-- Member list items generated by JS -->
        </ul>

        <!-- Position Management Section -->
        <div id="position-management-section">
             <h4>Manage Positions</h4>
             <div id="position-input-area">
                 <input type="text" id="positionNameInput" placeholder="Enter position name to add">
                 <button id="addPositionBtn">Add Position</button>
             </div>
             <!-- <<< MODIFIED: List is now just a container for JS rendering >>> -->
             <ul id="position-list">
                 <!-- Position list items with controls will be generated by admin.js -->
                 <!-- Example structure (generated by JS):
                 <li data-position-id="1">
                     <div class="position-details">
                         <span class="position-name">Sound</span>
                         <div class="position-config">
                             <fieldset class="assignment-type-group">...</fieldset>
                             <fieldset class="allowed-days-group">...</fieldset>
                         </div>
                     </div>
                     <div class="position-actions">
                         <button class="save-position-btn">Save</button>
                         <button class="delete-position-btn">x</button>
                     </div>
                 </li>
                 -->
             </ul>
             <div id="position-feedback-message" class="feedback-message" style="margin-top: 10px;"></div> <!-- Feedback for position save errors -->
         </div>

        <!-- Unavailability Section -->
        <div id="unavailability-section">
            <h4>Member Unavailability (Current Month)</h4>
             <div id="unavailability-input-area">
                <div>
                    <label for="unavailabilityDate">Date:</label>
                    <input type="date" id="unavailabilityDate">
                </div>
                <div>
                    <label for="unavailabilityMember">Member:</label>
                    <select id="unavailabilityMember">
                        <option value="">-- Select Member --</option>
                    </select>
                </div>
                <button id="addUnavailabilityBtn">Mark Unavailable</button>
            </div>
            <ul id="unavailable-list">
                <!-- Unavailability list items generated by JS -->
            </ul>
        </div>

        <!-- Override Assignment Days Section -->
        <div id="override-days-section">
             <h4>Override Assignment Days</h4>
              <div id="override-day-input-area">
                 <label for="overrideDateInput" class="visually-hidden">Override Date:</label>
                 <input type="date" id="overrideDateInput" title="Select date to force assignments">
                 <label for="overrideTimeInput" class="visually-hidden">Override Time:</label>
                 <input type="time" id="overrideTimeInput" title="Select time for override event (HH:MM)" required>
                 <button id="addOverrideDayBtn">Add Override Day</button>
             </div>
             <ul id="override-days-list">
                <!-- Override days list items generated by JS -->
             </ul>
         </div>

        <!-- Special Assignments Section -->
        <div id="special-assignments-section">
             <h4>Add Special Assignment Slot (Current Month)</h4>
             <div id="special-assignment-input-area">
                <div>
                    <label for="specialAssignmentDate">Date:</label>
                    <input type="date" id="specialAssignmentDate">
                </div>
                <div>
                    <label for="specialAssignmentPosition">Position:</label>
                    <select id="specialAssignmentPosition">
                        <option value="">-- Select Position --</option>
                    </select>
                </div>
                <button id="addSpecialAssignmentBtn">Add Slot</button>
            </div>
            <ul id="special-assignments-list">
                <!-- Special assignments list items generated by JS -->
            </ul>
         </div>

        <!-- Remove Assignment Slot Section -->
        <div id="removed-assignments-section">
            <h4>Remove Assignment Slot (Current Month)</h4>
            <div id="removed-assignment-input-area">
               <div>
                   <label for="removedAssignmentDate">Date:</label>
                   <input type="date" id="removedAssignmentDate">
               </div>
               <div>
                   <label for="removedAssignmentPosition">Position:</label>
                   <select id="removedAssignmentPosition">
                       <option value="">-- Select Position --</option>
                   </select>
               </div>
               <button id="addRemovedAssignmentBtn">Remove Slot</button>
           </div>
           <ul id="removed-assignments-list">
               <!-- Removed assignments list items generated by JS -->
           </ul>
        </div>

        <!-- Upcoming Automated Notifications Section -->
        <div id="upcoming-notifications-section">
            <h4>Upcoming Notifications</h4>
            <ul id="upcoming-notifications-list">
                <!-- Upcoming notification list items generated by JS -->
                <!-- Example:
                <li>
                    <span>[Mon, 01 Jan ~10:00] Member Name (Position)</span>
                </li>
                -->
            </ul>
        </div>

        <!-- User Management Section -->
        <div id="user-management-section">
            <h4>Manage Users</h4>
            <div id="user-input-area">
                <div class="form-group">
                    <label for="newUsername">Username:</label>
                    <input type="text" id="newUsername" placeholder="New username" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">Password:</label>
                    <input type="password" id="newPassword" placeholder="New password" required>
                </div>
                <div class="form-group">
                    <label for="newUserRole">Role:</label>
                    <select id="newUserRole">
                        <option value="user" selected>User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <button id="addUserBtn">Add User</button>
            </div>
            <div id="user-feedback-message" class="feedback-message"></div>
        </div>

    </div> <!-- END #team-management -->

    <!-- Calendar Section -->
    <div id="calendar-view">
         <div id="calendar-header">
             <div id="calendar-nav-buttons">
                 <button id="prevMonthBtn">< Prev</button>
                 <button id="nextMonthBtn">Next ></button>
             </div>
            <h2 id="monthYearHeader">Month Year</h2>
            <button id="randomizeBtn">Randomize Assignments</button>
            <div id="notify-day-controls">
                <input type="date" id="notifyDayDateInput" title="Select date to notify assigned members">
                <button id="notifyDayBtn" title="Send SMS to all members assigned on selected date">Notify Day</button>
            </div>
            <button id="logoutBtn">Logout</button>
            <button id="theme-toggle">ðŸŒ“ Toggle Theme</button>
        </div>
        <table id="calendar">
            <thead>
                <tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>
            </thead>
            <tbody id="calendar-body"></tbody>
        </table>
        <ul id="calendar-body-mobile" style="display: none;"></ul>

        <!-- <<< ADDED: Statistics Section >>> -->
        <div id="statistics-section" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color);">
            <h3>Monthly Assignment Statistics</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 20px;">
                <div style="flex: 1; min-width: 200px;">
                    <h4>Assignments per Member:</h4>
                    <ul id="memberStatsList" style="list-style: none; padding: 0; max-height: 200px; overflow-y: auto;">
                        <!-- Stats will be populated by JS -->
                    </ul>
                </div>
                <div style="flex: 1; min-width: 250px; max-width: 350px; position: relative;">
                    <h4>Assignment Distribution (Member):</h4>
                    <canvas id="memberStatsChart"></canvas>
                     <div id="stats-member-no-data" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--text-secondary); display: none;">No assignments this month.</div>
                </div>
                <!-- <<< ADDED: Position Statistics >>> -->
                <div style="flex: 1; min-width: 200px; border-left: 1px solid var(--border-color); padding-left: 20px;">
                    <h4>Assignments per Position:</h4>
                    <ul id="positionStatsList" style="list-style: none; padding: 0; max-height: 200px; overflow-y: auto;">
                        <!-- Stats will be populated by JS -->
                    </ul>
                </div>
                 <div style="flex: 1; min-width: 250px; max-width: 350px; position: relative;">
                    <h4>Assignment Distribution (Position):</h4>
                    <canvas id="positionStatsChart"></canvas>
                     <div id="stats-position-no-data" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--text-secondary); display: none;">No assignments this month.</div>
                </div>
                <!-- <<< END ADDED: Position Statistics >>> -->
                <!-- <<< ADDED: Unavailability Statistics >>> -->
                <div style="flex: 1; min-width: 200px; border-left: 1px solid var(--border-color); padding-left: 20px;">
                    <h4>Days Off (Current Month):</h4>
                    <ul id="memberUnavailabilityStatsList" style="list-style: none; padding: 0; max-height: 200px; overflow-y: auto;">
                        <!-- Unavailability stats will be populated by JS -->
                    </ul>
                    <div id="stats-unavailability-no-data" style="color: var(--text-secondary); font-style: italic; font-size: 0.9em; display: none; margin-top: 5px;">No unavailability this month.</div>
                </div>
                <!-- <<< END ADDED: Unavailability Statistics >>> -->
                <!-- <<< ADDED: Days Not Scheduled Statistics >>> -->
                <div style="flex: 1; min-width: 200px; border-left: 1px solid var(--border-color); padding-left: 20px;">
                    <h4>Days Not Scheduled (When Qualified):</h4>
                    <ul id="memberDaysNotScheduledStatsList" style="list-style: none; padding: 0; max-height: 200px; overflow-y: auto;">
                        <!-- Stats will be populated by JS -->
                    </ul>
                    <div id="stats-not-scheduled-no-data" style="color: var(--text-secondary); font-style: italic; font-size: 0.9em; display: none; margin-top: 5px;">All qualified members scheduled when possible.</div>
                </div>
                <!-- <<< END ADDED >>>
            </div>
        </div>
        <!-- <<< END ADDED >>>

    </div> <!-- END #calendar-view -->
</div> <!-- END #scheduler -->

<!-- Visually Hidden Style -->
<style>
    .visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
    /* Add styles for the new position list items in style.css later */
    #position-list li { display: flex; flex-direction: column; gap: 10px; border-bottom: 1px solid var(--list-item-border); padding: 10px 5px; }
    #position-list li:last-child { border-bottom: none; }
    .position-details { display: flex; flex-direction: column; gap: 8px; }
    .position-name { font-weight: bold; }
    .position-config { display: flex; flex-direction: column; gap: 5px; margin-left: 10px; }
    .assignment-type-group label, .allowed-days-group label { display: block; margin-bottom: 3px; font-size: 0.9em; }
    .allowed-days-group { display: flex; flex-wrap: wrap; gap: 5px 10px; margin-top: 5px; padding-left: 15px; font-size: 0.9em; }
    .allowed-days-group[disabled] { opacity: 0.5; pointer-events: none; }
    .allowed-days-group label { margin-bottom: 0; display: inline-flex; align-items: center;}
    .allowed-days-group input[type="checkbox"] { margin-right: 4px; }
    .position-actions { display: flex; justify-content: flex-end; gap: 5px; align-items: center; margin-top: 5px; }
    .position-actions .save-position-btn { background-color: var(--button-primary-bg); color: var(--button-primary-text); font-size: 0.85em; padding: 4px 8px; }
    .position-actions .save-position-btn:hover { background-color: var(--button-primary-hover-bg); }
    .position-actions .delete-position-btn { font-size: 1em; /* Keep delete button size consistent */ }
    /* Fieldset styling reset */
    fieldset { border: none; padding: 0; margin: 0; min-width: 0; }
    legend { padding: 0; }

    /* <<< ADDED: Styles for Removed Assignments Section >>> */
    #removed-assignments-section {
        margin-top: 25px;
        padding-top: 15px;
        border-top: 2px solid var(--border-color);
        transition: border-color 0.3s ease;
    }
    #removed-assignment-input-area {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 10px;
        align-items: flex-end;
    }
    #removed-assignment-input-area label {
        font-size: 0.9em;
        color: var(--text-secondary);
        margin-bottom: 3px;
        display: block;
        transition: color 0.3s ease;
    }
    #removed-assignment-input-area > div {
        flex: 1;
        min-width: 120px;
    }
    #removed-assignment-input-area input[type="date"],
    #removed-assignment-input-area select {
        width: 100%;
        padding: 6px 8px;
        font-size: 0.95em;
    }
    #removed-assignment-input-area button {
        flex-grow: 0;
        align-self: flex-end; /* Align button properly */
        background-color: var(--button-danger-bg);
        color: var(--button-danger-text);
        border-color: var(--button-danger-border);
    }
     #removed-assignment-input-area button:hover {
        background-color: var(--button-danger-hover-bg);
    }
    #removed-assignments-list {
        list-style: none;
        padding: 0;
        margin: 0;
        overflow-y: auto;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        padding: 8px;
        background-color: var(--list-bg);
        max-height: 150px;
        min-height: 50px;
        margin-top: 10px;
        font-size: 0.9em;
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    #removed-assignments-list li {
        padding: 6px 8px;
        border-bottom: 1px solid var(--list-item-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    #removed-assignments-list li:last-child { border-bottom: none; }
    #removed-assignments-list button {
        /* Inherits general list button styles (like delete icon color/hover) */
        font-size: 1em; padding: 0 3px;
    }
    /* <<< END ADDED >>> */

</style>

<script src="admin.js"></script>
</body>
</html>
